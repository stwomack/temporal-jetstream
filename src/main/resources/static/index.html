<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temporal Jetstream - Flight Control</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">‚úàÔ∏è Temporal Jetstream - Flight Control Center</span>
            <span class="badge bg-success" id="connectionStatus">Connecting...</span>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <!-- Left Panel: Start New Flight -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5>Start New Flight</h5>
                    </div>
                    <div class="card-body">
                        <form id="startFlightForm">
                            <div class="mb-3">
                                <label for="flightNumber" class="form-label">Flight Number</label>
                                <input type="text" class="form-control" id="flightNumber" placeholder="AA1234" required>
                            </div>
                            <div class="mb-3">
                                <label for="departureStation" class="form-label">Departure</label>
                                <input type="text" class="form-control" id="departureStation" placeholder="ORD" required>
                            </div>
                            <div class="mb-3">
                                <label for="arrivalStation" class="form-label">Arrival</label>
                                <input type="text" class="form-control" id="arrivalStation" placeholder="DFW" required>
                            </div>
                            <div class="mb-3">
                                <label for="gate" class="form-label">Gate</label>
                                <input type="text" class="form-control" id="gate" placeholder="B12" required>
                            </div>
                            <div class="mb-3">
                                <label for="aircraft" class="form-label">Aircraft</label>
                                <input type="text" class="form-control" id="aircraft" placeholder="N123AA" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Start Flight</button>
                        </form>
                    </div>
                </div>

                <!-- Event Log -->
                <div class="card mt-3">
                    <div class="card-header bg-secondary text-white">
                        <h6>Event Log</h6>
                    </div>
                    <div class="card-body" id="eventLog" style="max-height: 300px; overflow-y: auto;">
                        <small class="text-muted">Waiting for events...</small>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Active Flights -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                        <h5>Active Flights</h5>
                        <div>
                            <button class="btn btn-sm btn-warning me-2" onclick="simulateFailure()">‚ö° Simulate Failure</button>
                            <button class="btn btn-sm btn-light" onclick="refreshFlights()">Refresh</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="flightsList">
                            <p class="text-muted text-center">No active flights. Start a flight to see it here.</p>
                        </div>
                    </div>
                </div>

                <!-- Selected Flight Details -->
                <div class="card mt-3" id="flightDetailsCard" style="display: none;">
                    <div class="card-header bg-info text-white">
                        <h5>Flight Details: <span id="selectedFlightNumber"></span></h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Status:</strong> <span id="detailState" class="badge"></span></p>
                                <p><strong>Route:</strong> <span id="detailRoute"></span></p>
                                <p><strong>Gate:</strong> <span id="detailGate"></span></p>
                                <p><strong>Aircraft:</strong> <span id="detailAircraft"></span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Delay:</strong> <span id="detailDelay"></span> minutes</p>
                                <p><strong>Departure:</strong> <span id="detailDeparture"></span></p>
                                <p><strong>Arrival:</strong> <span id="detailArrival"></span></p>
                            </div>
                        </div>
                        <hr>
                        <div class="btn-group w-100 mb-2" role="group">
                            <button type="button" class="btn btn-warning" onclick="showDelayModal()">Announce Delay</button>
                            <button type="button" class="btn btn-primary" onclick="showGateChangeModal()">Change Gate</button>
                            <button type="button" class="btn btn-danger" onclick="cancelSelectedFlight()">Cancel Flight</button>
                        </div>
                        <button type="button" class="btn btn-outline-secondary w-100" onclick="showHistoryModal()">üìã View Audit Trail</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delay Modal -->
    <div class="modal fade" id="delayModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Announce Delay</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="delayMinutes" class="form-label">Delay (minutes)</label>
                        <input type="number" class="form-control" id="delayMinutes" placeholder="30" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-warning" onclick="announceDelay()">Announce</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Gate Change Modal -->
    <div class="modal fade" id="gateChangeModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Change Gate</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="newGate" class="form-label">New Gate</label>
                        <input type="text" class="form-control" id="newGate" placeholder="C25" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="changeGate()">Change Gate</button>
                </div>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal fade" id="historyModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Audit Trail: <span id="historyFlightNumber"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: 500px; overflow-y: auto;">
                    <!-- Tabs for different history views -->
                    <ul class="nav nav-tabs mb-3" id="historyTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="workflow-history-tab" data-bs-toggle="tab" data-bs-target="#workflow-history" type="button" role="tab">
                                Temporal Workflow History
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="mongodb-history-tab" data-bs-toggle="tab" data-bs-target="#mongodb-history" type="button" role="tab">
                                MongoDB State Transitions
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content" id="historyTabContent">
                        <!-- Temporal Workflow History Tab -->
                        <div class="tab-pane fade show active" id="workflow-history" role="tabpanel">
                            <div id="historyTimeline">
                                <div class="text-center">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p class="mt-2">Loading workflow history...</p>
                                </div>
                            </div>
                        </div>
                        <!-- MongoDB State Transitions Tab -->
                        <div class="tab-pane fade" id="mongodb-history" role="tabpanel">
                            <div id="mongodbTransitions">
                                <div class="text-center">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p class="mt-2">Loading state transitions...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="exportHistory()">üì• Export as JSON</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.6.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
