## Codebase Patterns
- Use Spring Boot 4.0.1 with Java 21 for this project
- Temporal Java SDK 1.32.1 is configured to connect to localhost:7233
- Maven wrapper (./mvnw) is used for all build commands
- Application starts on port 8080
- docker-compose.yml manages Kafka and MongoDB (NOT Temporal)
- Temporal runs via separate `temporal server start-dev` command

---

## 2026-01-26 13:52 - story-1

**What was implemented:**
- Created Spring Boot 4.0.1 project structure with Java 21
- Added Maven wrapper for consistent builds
- Created pom.xml with latest stable dependencies:
  - Spring Boot 4.0.1
  - Temporal Java SDK 1.32.1
  - Spring WebSocket for future real-time UI
  - Spring Kafka for event integration
  - MongoDB for persistence
- Created docker-compose.yml with Kafka (7.8.0) and MongoDB (8.0)
- Created Application.java with @SpringBootApplication
- Created application.yml with Temporal configuration (localhost:7233, flight-task-queue)
- Created comprehensive README.md with prerequisites and quick start

**Files changed:**
- pom.xml (created)
- src/main/java/com/temporal/jetstream/Application.java (created)
- src/main/resources/application.yml (created)
- docker-compose.yml (created)
- README.md (created)
- mvnw, mvnw.cmd, .mvn/wrapper/* (Maven wrapper)
- .gitignore (already existed, no changes needed)

**Learnings for future iterations:**
- Spring Boot 4.0.1 is the latest stable version (as of January 2026)
- Spring Boot 4.0 requires Java 17 minimum but supports Java 21 and Java 25
- Had to clean up duplicate Application.java file in com.example package that was causing build failure
- ./mvnw clean install completes successfully in under 1 second (after initial dependency download)
- Application starts successfully in ~0.6 seconds and connects to MongoDB
- Temporal server must be started separately with `temporal server start-dev` (not in docker-compose)
- Task queue is configured as "flight-task-queue" for workflow operations

---
## 2026-01-26 14:00 - story-2

**What was implemented:**
- Created Flight domain model class with all required fields:
  - flightNumber, flightDate, departureStation, arrivalStation
  - scheduledDeparture, scheduledArrival, currentState, gate, aircraft, delay
- Created FlightState enum with all lifecycle states:
  - SCHEDULED, BOARDING, DEPARTED, IN_FLIGHT, LANDED, COMPLETED, CANCELLED
- Created FlightWorkflow interface with @WorkflowInterface and @WorkflowMethod annotations
- Implemented FlightWorkflowImpl with deterministic state machine:
  - Transitions through states: SCHEDULED -> BOARDING -> DEPARTED -> IN_FLIGHT -> LANDED -> COMPLETED
  - Uses Workflow.sleep(Duration.ofSeconds(2)) between state transitions for simulation
  - Proper logging at each state transition
- Created TemporalConfig @Configuration class:
  - Creates WorkflowServiceStubs, WorkflowClient, WorkerFactory, and Worker beans
  - Registers FlightWorkflowImpl to 'flight-task-queue'
  - Worker starts automatically via @PostConstruct and stops via @PreDestroy
- Created comprehensive unit tests using TestWorkflowEnvironment:
  - Test with TestWorkflowExtension for simplified testing
  - Test with manual TestWorkflowEnvironment setup and WorkflowId verification
  - Both tests verify workflow completes with COMPLETED state

**Files changed:**
- src/main/java/com/temporal/jetstream/model/Flight.java (created)
- src/main/java/com/temporal/jetstream/model/FlightState.java (created)
- src/main/java/com/temporal/jetstream/workflow/FlightWorkflow.java (created)
- src/main/java/com/temporal/jetstream/workflow/FlightWorkflowImpl.java (created)
- src/main/java/com/temporal/jetstream/config/TemporalConfig.java (created)
- src/test/java/com/temporal/jetstream/workflow/FlightWorkflowTest.java (created)
- prd.json (updated story-2 passes: true)

**Learnings for future iterations:**
- Workflow implementations must be deterministic - use Workflow.sleep() not Thread.sleep()
- Use Workflow.getLogger() for logging within workflows, not standard loggers
- TestWorkflowExtension provides cleaner test setup with automatic worker registration
- WorkflowId format should be 'flight-{flightNumber}-{flightDate}' for uniqueness
- TemporalConfig uses @PostConstruct to start worker after Spring context initialization
- Worker logs 'Worker started for task queue: flight-task-queue' on successful startup
- Unit tests complete quickly (~1.3 seconds) using in-memory test server
- Application startup shows 'Registered FlightWorkflowImpl for task queue: flight-task-queue'
- FlightWorkflowImpl doesn't need @Workflow annotation (interface is sufficient)
- Flight domain model initializes with SCHEDULED state and 0 delay by default

---
